# File Manager App

A Next.js application for uploading, managing, and previewing files (PDF, Markdown, TXT) with Supabase backend.

## Features

- **Upload files**: Support for PDF, MD, and TXT formats
- **Preview files**: Different preview modes for each file type
  - PDF: Embedded viewer + extracted text view
  - Markdown: Formatted preview + raw source view
  - TXT: Text view with scrolling
- **Manage files**: View file list, delete files
- **AI Summaries**: Generate AI-powered summaries using OpenAI's GPT-4 mini model
  - Custom prompts per file for tailored summaries
  - Default prompt for when no custom prompt is set
  - Summary storage in database
- **Responsive design**: Mobile-friendly UI

## Tech Stack

- **Framework**: Next.js
- **Backend**: Serverless functions (Vercel compatible)
- **Database & Storage**: Supabase
- **AI**: OpenAI GPT-4 mini (via @ai-sdk)
- **Dependencies**: react, pdf-parse, markdown-it, ai, @ai-sdk/openai

## Quick Start

### 1. Prerequisites

- Node.js 16+ and npm
- Supabase account with:
  - Database and API credentials
  - Storage bucket named `files`

### 2. Install Dependencies

```bash
cd my-app
npm install
```

### 3. Set Up Supabase

#### Create Tables

In your Supabase SQL editor, run:

```sql
-- Files table
create table if not exists files (
  id bigint generated by default as identity primary key,
  name text not null,
  type text,
  path text not null,
  text text,
  created_at timestamptz default now()
);

-- Create index for faster queries
create index if not exists idx_files_created on files(created_at);
```

#### Create Storage Bucket

1. Go to Supabase Dashboard → Storage → New Bucket
2. Name it: `files`
3. Set it to public (or use signed URLs for private access)

### 4. Configure Environment

Create `.env.local` in the `my-app` directory:

```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

Get these values from Supabase:
- Settings → Project API keys → Project URL & Service Role Key

### 5. Run Development Server

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) to view the app.

### 6. (Optional) Set Up AI Summary Feature

To enable AI-powered summaries:

1. Choose your AI provider:
   - **GitHub Models** (recommended) - See [GITHUB_MODELS.md](./GITHUB_MODELS.md)
   - **OpenAI API** - See [AI_SETUP.md](./AI_SETUP.md)

2. Add credentials to `.env.local`:
   ```env
   # Option 1: GitHub Models (priority by default)
   GITHUB_TOKEN=github_pat_...
   
   # Option 2: OpenAI (used if GitHub Token not available)
   OPENAI_API_KEY=sk-...
   ```

3. Run the SQL setup commands from [DATABASE_SETUP.sql](./DATABASE_SETUP.sql)

4. Restart the dev server

## API Endpoints

### Files

- **GET `/api/files`** - List all files
  ```json
  { "files": [...] }
  ```

- **POST `/api/files`** - Upload a file (multipart/form-data)
  ```bash
  curl -F "file=@example.pdf" http://localhost:3000/api/files
  ```

- **DELETE `/api/files/[id]`** - Delete a file by ID

### AI Summaries

- **GET `/api/summary?file_id={id}`** - Get existing summary
  ```json
  { "id": 1, "content": "...", "created_at": "...", "updated_at": "..." }
  ```

- **POST `/api/summary`** - Generate or update summary
  ```json
  { "file_id": 123 }
  ```

### Prompts (AI Settings)

- **GET `/api/prompts`** - List all prompts

- **GET `/api/prompts/{id}`** - Get prompt for specific file (or default)

- **PUT `/api/prompts/{id}`** - Update/create prompt for file
  ```json
  { "prompt_text": "Custom prompt text here..." }
  ```

- **DELETE `/api/prompts/{id}`** - Delete custom prompt for file

See [AI_SETUP.md](./AI_SETUP.md) for detailed AI configuration and usage.

## Building & Deployment

### Build for Production

```bash
npm run build
npm start
```

### Deploy to Vercel

1. Push your code to GitHub
2. Connect your repository to Vercel
3. Add environment variables in Vercel settings:
   - `SUPABASE_URL`
   - `SUPABASE_SERVICE_ROLE_KEY`
4. Deploy!

## File Support

| Format | Preview | Extract | Max Size |
|--------|---------|---------|----------|
| PDF | Yes (embed) | Yes (pdfparse) | Vercel limit |
| Markdown | Yes (rendered) | Yes (plain text) | Vercel limit |
| TXT | Plain text | Yes | Vercel limit |

## Troubleshooting

**Upload fails**: Check environment variables and Supabase bucket permissions.

**Preview not showing**: Ensure Supabase bucket is public or has appropriate CORS settings.

**Build fails**: Run `npm install` to ensure all dependencies are installed.

**AI Summary generation fails**: 
- Check `OPENAI_API_KEY` is set in `.env.local`
- Verify OpenAI account has available credits
- Check database tables are created (run [DATABASE_SETUP.sql](./DATABASE_SETUP.sql))
- See [AI_SETUP.md](./AI_SETUP.md) for troubleshooting

## Development Tips

- Use `.env.local` for local development (not committed to git)
- Check browser console for API errors
- Supabase logs are available in the dashboard
