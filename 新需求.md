# 项目新需求说明 - 实现进度

## ✅ 已完成的需求

- ✅ 添加ai总结功能，使用GitHub Models的GPT-4.1-mini模型（或OpenAI的gpt-4o-mini作为备用），生成总结后存储在数据库中，并在文件详情页新增标签显示总结内容。
- ✅ 添加ai总结设置功能，允许用户为ai设置提示词。设置界面包含输入框和保存按钮，提示词存储在数据库中，并在生成总结时使用该提示词。
- ✅ 每个文件的总结内容和提示词独立存储，用户可以为不同文件设置不同的提示词，并生成对应的总结。
- ✅ 用户可以设置默认提示词，若某文件未设置提示词，则使用默认提示词生成总结。

## 实现细节

### 新增功能
1. **AI总结标签** - 在文件详情页新增"✨ Summary"标签
2. **总结生成** - 点击"🤖 Generate Summary"按钮即可生成总结
3. **提示词设置** - 点击"⚙️ Settings"按钮可以：
   - 查看并编辑当前文件的自定义提示词
   - 保存自定义提示词
   - 删除自定义提示词

### 新增数据库表
- **summaries表** - 存储每个文件的AI生成的总结内容
- **prompts表** - 存储提示词（包括默认提示词和文件特定的提示词）

### 新增API端点
- `GET /api/summary?file_id={id}` - 获取文件的现有总结
- `POST /api/summary` - 生成或更新文件的总结
- `GET /api/prompts` - 获取所有提示词
- `GET /api/prompts/{id}` - 获取文件的提示词或默认提示词
- `PUT /api/prompts/{id}` - 创建或更新文件特定的提示词
- `DELETE /api/prompts/{id}` - 删除文件的自定义提示词

### 前端UI更新
- 在Tabs组件中添加Summary标签
- 添加生成总结和设置提示词的按钮
- 实时显示生成的总结内容
- 响应式提示词编辑界面

## 使用说明

### 设置环境变量
在 `.env.local` 中添加：
```env
OPENAI_API_KEY=your-openai-api-key
```

### 初始化数据库
运行 `DATABASE_SETUP.sql` 中的SQL命令在Supabase中创建必要的表。

### 功能使用流程
1. 上传文件（PDF/MD/TXT）
2. 点击"View"查看文件详情
3. 点击"✨ Summary"标签
4. （可选）点击"⚙️ Settings"设置自定义提示词
5. 点击"🤖 Generate Summary"生成总结
6. 等待AI生成总结，结果会自动显示在页面上

## 文件清单

### 新建文件
- `lib/ai.js` - AI调用函数库
- `pages/api/summary.js` - 总结生成API（已改进）
- `pages/api/prompts/[id].js` - 提示词管理API
- `pages/api/prompts/index.js` - 获取所有提示词
- `DATABASE_SETUP.sql` - 数据库初始化SQL脚本
- `AI_SETUP.md` - AI功能详细配置和使用说明

### 修改文件
- `pages/index.js` - 前端UI，添加Summary标签和相关功能
- `package.json` - 添加AI相关依赖（ai, @ai-sdk/openai）
- `.env.example` - 添加AI环境变量示例
- `README.md` - 添加AI功能说明
- `.github/SPEC.md` - 更新规格说明和需求记录

## 配置检查清单

- [ ] 在Supabase管理台运行DATABASE_SETUP.sql创建表
- [ ] 获取OpenAI API密钥
- [ ] 在.env.local中配置OPENAI_API_KEY
- [ ] 重启开发服务器
- [ ] 测试AI总结功能

